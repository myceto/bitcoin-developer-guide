### 交易資料 | Transaction Data

每一個區塊必須包含一筆或者多筆交易。這些交易的第一筆必須是一個 coinbase 交易，也被稱作 generation 交易，它包含了這個區塊所有花費和獎勵（由一個區塊的補貼和這個區塊任何交易產生的交易費用構成）。

一個 coinbase 交易的 UTXO 有一個特殊的條件，那就是在之後的 100 個區塊內都不能被花費（被用作輸入）。這臨時性的杜絕了一個礦工花費掉因為分叉而可能被判定為陳舊區塊（這個 coinbase 交易因此被銷燬掉）中所包含的補貼和交易費。

區塊並不要求一定包含非 coinbase 的交易，但是礦工們為了把他們的交易手續費包含其中總是會帶上額外的交易。

所有的交易，包括 coinbase 交易，都會被編碼為二進位制的 rawtransaction 格式存入區塊。

通過對 rawtransaction 格式做雜湊得到了交易標識符（txid）。從這些 txids 中，通過將一個 txid 與另一個 txid 配對然後做雜湊運算，最終構建了 merkle 樹。如果 txids 的個數為奇數，那麼沒有被配對的那個 txid 將會與他自身的一個副本配對做雜湊。

以上得到的雜湊值再一一配對，讓一個雜湊值與另一個再做雜湊運算。任何沒有可配對的雜湊值與自身配對做雜湊。這個過程迭代進行直到只剩下一個雜湊值，這就是 merkle 根節點。

例如，如果交易只是連線（沒有做雜湊運算）在一起，那麼具有 5 個交易的 merkle 樹應該如下圖所示：

```
       ABCDEEEE .......Merkle 根節點
      /        \
   ABCD        EEEE
  /    \      /
 AB    CD    EE .......E 與它自身配對
/  \  /  \  /
A  B  C  D  E .........交易
```

在[簡化支付驗證（SPV）](https://bitcoin.org/en/glossary/simplified-payment-verification)提案中指出，merkle 樹允許客戶端通過一個完整節點從一個區塊頭中獲取其 merkle 根節點和中間雜湊值列表來驗證一個交易被包含在這個區塊中。這個完整節點並不需要是可信的，因為偽造區塊頭十分困難而中間雜湊值是不可能被偽造的，否則驗證就會失敗。

例如，要驗證交易 D 被加到了區塊中，一個 SPV 客戶端只需要一份 C，AB 和 EEEE 的副本進而做雜湊運算得到 merkle 根節點，客戶端並不需要知道任何其他交易的資訊。如果這 5 個交易的大小都是一個區塊的最大上限，那麼下載整個區塊需要下載 500,000 個位元組，但下載樹的雜湊值和區塊頭僅僅需要 140 個位元組。

注意：如果在同一個區塊中找到了相同的 txids，那麼 merkle 樹可能會出現與另一個區塊的碰撞，歸因於 merkle 樹對非平衡的實現（對孤立的雜湊值做複製）會將一個區塊中一些或全部的重複內容移除掉。從對於單獨的交易具有相同的 txid 是不現實的角度來看，merkle 樹的實現不會對誠實的軟體增加負擔，但如果一個區塊的無效狀態要被快取那麼就必須做檢查，否則，一個移除了重複交易的有效區塊會因為具有相同的 merkle 根節點和區塊雜湊而被快取的無效狀態拒絕，導致了編號為 [CVE-2012-2459](https://en.bitcoin.it/wiki/CVEs#CVE-2012-2459) 的安全問題。