## 交易 | Transactions

交易讓使用者可以花費聰（satoshis）。每一筆交易是由多個部分構成的，使單純直接的支付和複雜的交易成為可能。這一章節將對其每一部分做詳解並展示如果將它們拼接起來構建一個完成的交易。

為了便於理解，這一節假設不存在 coinbase 交易。只有比特幣礦工可以建立 coinbase 交易，它們對於下面會提到的很多規則都將是例外。這裡並不會指出 coinbase 對哪一條規則是例外，你可以通過閱讀本指南中區塊鏈章節中的 coinbase 交易小節來做了解。

![](./en-tx-overview.svg)

上圖展示了一個比特幣交易的主要部分。每一個交易至少有一個輸入和一個輸出。每一個輸入會花費掉上一個輸出的聰。一個輸出會作為一個未花費交易輸出（UTXO）等待著作為輸入被花費掉。當你的比特幣錢包顯示你有 10,000 聰餘額時，它真實的表意是你有 10,000 聰作為 UTXOs 在等待著。

每一個交易具有一個四位元組的交易版本號，它告知比特幣節點和礦工應使用哪一套規則來驗證它。這使得開發者在為未來的交易建立新規則時可以不驗證之前的交易。

![](./en-tx-overview-spending.svg)

每一個輸出都有一個預設的索引數值，由其在交易中的位置決定，第一個輸出就是輸出零。輸出包含以聰為計數單位的金額，通過滿足一個特定條件的 pubkey 指令碼來支付。任何可以滿足 pubkey 指令碼特定條件的人都可以花費對應金額的聰。

輸入通過使用交易 id（txid）和輸出索引數值（常被稱為輸出向量的"vout"）來辨識哪一個輸出被花費。它同時包含一個簽名指令碼，這個指令碼提供資料作為參數來滿足 pubkey 指令碼的特定條件。（序列數值和鎖定時間是關聯的，將會在後續小節中被一起涵蓋。）

下圖展示了使用這些特性的一個流程，Alice 給你 Bob 傳送了一個交易，使得 Bob 之後可以花費這個交易。Alice 和 Bob 使用了支付給公開雜湊（P2PKH）這種常用的交易類型。P2PKH 讓 Alice 可以傳送 satoshis 到一個比特幣地址，然後讓 Bos 之後可以花費這些 satoshis，其實使用了了一個簡單的密碼金鑰對。

![](./en-creating-p2pkh-output.svg)

Bob 必須在 Alice 能夠發給他交易前就生成一對私有/公開金鑰對。比特幣使用橢圓曲線數字簽名演算法（ECDSA），選用的是 secp256k1 曲線，secp256k1 的私鑰是 256 位的隨機資料。這份資料的副本可以被準確的轉化為 secp256k1 的公鑰。因為轉化可以在之後被準確的進行，公鑰是沒有儲存的必要性的。

然後公鑰（pubkey）進行密碼雜湊。這個公鑰雜湊之後也可以準確的算出，所以它也是不需要被儲存的。這個雜湊縮短並混淆了公鑰，使得手動的交易更容易並提供了安全性，用以抵抗一些未曾預料的問題，比如在未來可能出現通過公鑰重新構建出私鑰。

Bob 提供給 Alice 公鑰雜湊。公鑰雜湊通過編碼後就得到了比特幣地址，使用 base58 編碼得到的字元串包含了一個地址版本數字、雜湊值和一個錯誤校驗的校驗和用來捕獲錯別字。比特幣地址可以通過任何媒介傳播，包括單向媒介從而省去了消費者與接收者間的溝通，它可以之後編碼為任何其他格式，比如一個包含了 `bitcoin:` URI 的二維碼。

