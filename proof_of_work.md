### 工作量證明 | Proof Of Work

區塊鏈是通過網路上匿名的節點協同維護的，所以比特幣需要每個區塊證明在建立他們的過程中投入了足夠多的工作量，從而確保那些想篡改歷史區塊資訊的不可信懶的節點必須要比只想新增新區塊到區塊鏈的誠實節點付出更多的工作量。

將區塊鏈在一起使得只修改一個交易而不修改所有後續交易成為不可能。因此隨著新的區塊被新增到區塊鏈，修改一個特定區塊的成本在不斷提升，從而放大了工作量證明的作用。

比特幣中的工作量證明利用了密碼學雜湊的偽隨機性。一個好的密碼學雜湊演算法可以將任意資料轉換為看似隨機的數字。如果原始資料的任何地方被更改了，然後重新做雜湊，一個新的看似隨機的數字就產生出來了，所以通過更改原始資料預測雜湊值是不可能做到的。

為了證明你為創造一個區塊做了一些工作，你必須算出一個不超過某個特定值的區塊頭的雜湊值。比如，如果這個雜湊值最大為 2<sup>256</sup>－1，你可以證明你算出一個小於 2<sup>255</sup> 的雜湊值做了至多兩次組合。

在上面給出的例子中，你可能在某次嘗試中就得到了一個成功的雜湊值。你甚至可以估算出算出低於目標閾值的概率。比特幣設定了一個線性的概率，目標閾值越小，你需要嘗試計算的雜湊值次數越多（平均來說）。

當一個新的區塊的雜湊值至少與一致性協議期望的難度值相當時，它才會被加到區塊鏈中。每產生 2,016 個區塊，比特幣網路使用儲存在區塊頭中的時間戳來計算這 2,016 個區塊的第一個和最後一個區塊的時間差值，理想的值為 1,209,600 秒（及兩週）。

- 如果生成這 2,016 個區塊所用的時間比兩週短，那麼預期的難度將會相應的增長（大概為 300%），這樣在雜湊算力保持不變的情況下，之後的 2,016 個區塊的生成應該剛好會用兩週的時間。
- 如果生成這些區塊的時間超過了兩週，出於同樣的原因，預期的難度也會相應的遞減（大概為 75%）。

（注意：在比特幣核心實現中存在一個差一錯誤，導致算力難度的是由 2,016 個區塊中的 2,015 個區塊的時間戳來更新的，產生了一個微小的偏差。）

因為每一個區塊頭的雜湊值必須是比目標閾值要小的，並且每個區塊與先前的一個連結在一起，所以想對一個區塊做更改需要（一般來說）付出整個比特幣網路從原始區塊時間點到當前時間點所消耗的雜湊算力。只有當你擁有了整個網路大部分的雜湊算力時你才有可能發起一個有效的 51 攻擊來篡改交易紀錄（當然，需要指出的是，即便你擁有的算力小於 50%，仍然有機會發起這樣的攻擊。）

區塊頭提供了一些便於修改的欄位，例如 [nonce](https://en.bitcoin.it/wiki/Nonce) 欄位，因此獲取新的雜湊值時並不需要為新的交易而等待（譯者注：我理解這裡的意思是通過快取狀態而避免每次計算雜湊都需要遍歷交易記錄。）同時，只有區塊頭的 80 個位元組被用來當作工作量證明做雜湊，所以並不會因為區塊讀取其包含的大量的交易資料所產生的 I/O 延時而延緩雜湊運算，並且在新增一個額外的交易資料時只需要重新計算一下 merkle 樹的原始節點雜湊即可。